# 历史关键决策 & 理由

## 架构决策

### ADR-001: 选择 Temporal 作为工作流编排引擎
**日期：** 项目初期
**决策：** 使用 Temporal Python SDK 构建任务处理系统
**理由：**
- 内置的错误处理和重试机制
- 强大的状态持久化能力
- 支持复杂工作流编排
- 提供实时监控和可见性

### ADR-002: 采用异步回调机制处理外部API
**日期：** 视频生成集成阶段
**决策：** 实现专用回调服务器处理 Kling API 异步响应
**理由：**
- 外部API响应时间不可控
- 避免长时间阻塞工作流
- 通过 Workflow Signal 机制更新状态

### ADR-003: 使用 PostgreSQL + Elasticsearch 作为后端存储
**日期：** 可靠性增强阶段
**决策：** 配置 PostgreSQL 用于持久化，Elasticsearch 用于高级可见性
**理由：**
- PostgreSQL 提供可靠的事务性存储
- Elasticsearch 支持复杂查询和搜索
- 满足审计日志和状态追踪需求

### ADR-004: 实现全局并发控制机制
**日期：** 测试验证阶段
**决策：** 通过全局信号量控制并发任务数量
**理由：**
- 支持渐进式压力测试（1-100任务）
- 避免资源过载
- 便于可靠性验证

## 技术选型决策

### 数据模型设计
**决策：** 使用 Pydantic 定义类型安全的数据结构
**理由：** 提供运行时类型检查和数据验证

### API 设计
**决策：** 分离 API 服务器和回调服务器
**理由：** 职责分离，便于独立扩展和维护